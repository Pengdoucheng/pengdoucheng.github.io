<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI æ™‚é–“ç·¨è¼¯æ’ç¨‹å·¥å…·</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.daypilot.org/daypilot-lite.min.js"></script>
  <style>
    body { background-color: #f8f9fa; font-family: 'Noto Sans TC', sans-serif; }
    .container { max-width: 900px; padding: 30px 15px; }
    #schedule { height: 500px; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4 text-center">ğŸ—“ å¯æ‹–æ‹‰å¼æ™‚é–“ç·¨è¼¯å™¨ + AI æ™ºèƒ½å„ªåŒ–</h2>

    <div class="mb-3">
      <label for="apiKey" class="form-label">OpenAI API Keyï¼ˆæ¸¬è©¦ç”¨ï¼‰</label>
      <input type="password" id="apiKey" class="form-control" placeholder="sk-xxxx...">
    </div>

    <div id="schedule"></div>

    <button class="btn btn-primary mt-4 w-100" onclick="analyzeSchedule()">ğŸ¤– è«‹ AI æª¢æŸ¥ä¸¦å„ªåŒ–æ’ç¨‹</button>

    <div class="mt-4">
      <h5>AI å›æ‡‰å»ºè­°ï¼š</h5>
      <div id="aiOutput" class="p-3 bg-light border rounded" style="white-space: pre-wrap; min-height: 120px;"></div>
    </div>
  </div>

  <script>
    // ç¢ºä¿ç­‰é é¢æ¸²æŸ“å®Œæˆå†åˆå§‹åŒ– DayPilot
    window.addEventListener("DOMContentLoaded", () => {
      const dp = new DayPilot.Calendar("schedule");
      dp.viewType = "Day";
      dp.startDate = DayPilot.Date.today();
      dp.businessBeginsHour = 8;
      dp.businessEndsHour = 22;
      dp.init();

      // ç¯„ä¾‹å›ºå®šè¡Œç¨‹
      dp.events.list = [
        {
          id: DayPilot.guid(),
          text: "ä¸Šèª²ï¼ˆå›ºå®šï¼‰",
          start: DayPilot.Date.today().addHours(13),
          end: DayPilot.Date.today().addHours(15),
          movable: false,
          barColor: "#aaa"
        }
      ];
      dp.update();

      // ç¶åˆ°å…¨åŸŸï¼Œçµ¦ analyzeSchedule ç”¨
      window.dp = dp;
    });

    // GPT åˆ†æç¨‹å¼
    async function analyzeSchedule() {
      const key = document.getElementById("apiKey").value.trim();
      const output = document.getElementById("aiOutput");
      if (!key) {
        output.textContent = "è«‹è¼¸å…¥ OpenAI API é‡‘é‘°ã€‚";
        return;
      }

      const events = window.dp.events.list.map(e => {
        const start = new DayPilot.Date(e.start).toString("HH:mm");
        const end = new DayPilot.Date(e.end).toString("HH:mm");
        return `- ${start} - ${end} ${e.text}`;
      }).join("\n");

      const prompt = `ä»¥ä¸‹æ˜¯ä½¿ç”¨è€…ä»Šæ—¥çš„æ’ç¨‹ï¼š\n${events}\n\nè«‹ä½ ä½œç‚ºä¸€ä½æ™‚é–“ç®¡ç†æ•™ç·´ï¼Œæª¢æŸ¥é€™æ¨£çš„å®‰æ’æ˜¯å¦åˆç†ï¼Œæ˜¯å¦æœ‰è¡çªã€æ•ˆç‡ä¸ä½³æˆ–åˆ†é…ä¸å‡çš„åœ°æ–¹ï¼Œä¸¦æå‡ºå„ªåŒ–å»ºè­°ã€‚è‹¥æœ‰æ›´å¥½çš„å®‰æ’æ–¹å¼ä¹Ÿå¯åˆ—å‡ºã€‚`;

      output.textContent = "AI åˆ†æä¸­ï¼Œè«‹ç¨å€™...";

      try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${key}`
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: "ä½ æ˜¯ä¸€ä½å°ˆæ¥­æ™‚é–“è¦åŠƒæ•™ç·´ã€‚" },
              { role: "user", content: prompt }
            ]
          })
        });
        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content;
        output.textContent = reply || "âš ï¸ AI æ²’æœ‰æä¾›å»ºè­°ï¼Œè«‹ç¢ºèªè¼¸å…¥èˆ‡é‡‘é‘°æ˜¯å¦æ­£ç¢ºã€‚";
      } catch (err) {
        console.error(err);
        output.textContent = "âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼Œç„¡æ³•é€£ç·šæˆ–é‡‘é‘°ç„¡æ•ˆã€‚";
      }
    }
  </script>
</body>
</html>