<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>登入（含訪客直達 tool.html）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --bg:#0B0C10; --panel:#111318; --panel2:#0d0f14;
      --text:#F3F4F6; --muted:#A8B3C5; --line:rgba(255,255,255,.08);
      --primary:#6EA8FE; --primary2:#3F8CFF; --r:16px; --r-lg:22px;
      --shadow: 0 8px 28px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Inter, "PingFang TC","Noto Sans TC","Microsoft JhengHei", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 12% 10%, #182132 0%, transparent 55%),
        radial-gradient(900px 700px at 85% 20%, #13233a 0%, transparent 50%),
        linear-gradient(180deg, var(--bg), #07080c);
      display:grid; place-items:center; padding:24px;
    }
    .shell{width:min(100%, 980px); display:grid; grid-template-columns: 1.1fr 1fr; gap:24px}
    @media (max-width: 980px){ .shell{grid-template-columns:1fr} .hero{display:none} }
    .hero{
      border:1px solid var(--line); border-radius:var(--r-lg); padding:24px;
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:800}
    .brand-mark{ width:36px; height:36px; border-radius:12px;
      background: conic-gradient(from 210deg, #3cf, #7c4dff, #3cf);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25), 0 8px 20px rgba(124,77,255,.35);
    }
    .hero h1{margin:.6rem 0 .25rem; font-size: clamp(28px, 3vw, 40px); line-height:1.15}
    .muted{color:var(--muted)}
    .cards{margin-top:16px; display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
    .card{border:1px solid var(--line); border-radius:18px; padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));}
    .card h4{margin:0 0 6px; font-size:13px; letter-spacing:.3px; text-transform:uppercase; color:#cbd8ef}
    .card p{margin:0; font-size:13px; color:var(--muted)}

    .panel{
      border:1px solid var(--line); border-radius:var(--r-lg); padding:22px; box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      width:100%;
    }
    .section-title{display:flex; align-items:center; justify-content:space-between; gap:12px; margin:6px 0 10px}
    .tabs{display:flex; gap:8px; background:rgba(255,255,255,.06); padding:4px; border-radius:12px}
    .tab{appearance:none; border:0; padding:8px 14px; border-radius:10px; font-weight:700; font-size:13px; color:var(--muted); cursor:pointer}
    .tab[aria-selected="true"]{ background:#182030; color:#cfe3ff; box-shadow: inset 0 0 0 1px rgba(99,140,255,.25) }

    label{font-size:13px; color:#c9d3e6; display:block; margin:10px 0 6px}
    .ctl{display:flex; align-items:center; gap:8px; background:#0f1220; border:1px solid #22304a; border-radius:14px; padding:12px 14px}
    input[type="email"], input[type="password"], input[type="text"]{
      background:transparent; border:0; outline:0; color:var(--text); width:100%; font-size:16px;
    }
    .rows{display:grid; gap:10px}
    .actions{display:grid; gap:10px; margin-top:12px}
    .btn{appearance:none; border:0; border-radius:14px; padding:12px 14px; font-weight:800; letter-spacing:.3px; cursor:pointer}
    .btn-primary{ background: linear-gradient(180deg, var(--primary), var(--primary2)); color:#fff; box-shadow: 0 10px 28px rgba(63,140,255,.28)}
    .btn-line{ background:transparent; color:#cfe3ff; border:1px solid #2a3a5a}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .note{font-size:13px; color:var(--muted); margin-top:4px}
  </style>
</head>
<body>
  <div class="shell">
    <!-- 左側介紹 -->
    <aside class="hero">
      <div class="brand"><div class="brand-mark" aria-hidden="true"></div><span>自律控肉飯 · 工具箱</span></div>
      <h1>用更少力氣，做好更多事。</h1>
      <p class="muted">登入可雲端同步；不想註冊也能「訪客模式」直接用，會直接進到工具頁。</p>
      <div class="cards">
        <div class="card"><h4>簡潔介面</h4><p>霧面質感、暗色背景、清楚焦點。</p></div>
        <div class="card"><h4>第三方登入</h4><p>支援 Google；Apple 可再加。</p></div>
        <div class="card"><h4>訪客模式</h4><p>免註冊，直接前往 tool.html。</p></div>
        <div class="card"><h4>Supabase</h4><p>沿用你現有專案與金鑰。</p></div>
      </div>
      <p class="note">© 2025 自律控肉飯（登入介面）</p>
    </aside>

    <!-- 右側登入介面 -->
    <main class="panel">
      <section class="section-title">
        <h2 style="margin:0">登入 / 註冊</h2>
        <div class="tabs" role="tablist" aria-label="auth">
          <button class="tab" id="tab-in"  aria-selected="true"  aria-controls="p-in">登入</button>
          <button class="tab" id="tab-up"  aria-selected="false" aria-controls="p-up">註冊</button>
        </div>
      </section>

      <section id="auth">
        <!-- 登入 -->
        <div id="p-in" role="tabpanel" aria-labelledby="tab-in">
          <div class="rows">
            <div>
              <label for="email">電子郵件</label>
              <div class="ctl"><input id="email" type="email" placeholder="you@example.com" autocomplete="email"></div>
            </div>
            <div>
              <label for="password">密碼</label>
              <div class="ctl"><input id="password" type="password" placeholder="至少 6 碼" autocomplete="current-password"></div>
            </div>
          </div>
          <div class="actions">
            <button class="btn btn-primary" id="btnLogin">登入</button>
            <div class="grid2">
              <button class="btn btn-line" id="btnGoogle">使用 Google 登入</button>
              <button class="btn btn-line" id="btnGuest">直接使用（訪客模式）</button>
            </div>
            <p class="note">註冊後請到信箱完成驗證再登入。</p>
          </div>
        </div>

        <!-- 註冊 -->
        <div id="p-up" role="tabpanel" aria-labelledby="tab-up" hidden>
          <div class="rows">
            <div>
              <label for="email2">電子郵件</label>
              <div class="ctl"><input id="email2" type="email" placeholder="you@example.com" autocomplete="email"></div>
            </div>
            <div>
              <label for="password2">設定密碼</label>
              <div class="ctl"><input id="password2" type="password" placeholder="至少 6 碼" autocomplete="new-password"></div>
            </div>
          </div>
          <div class="actions">
            <button class="btn btn-primary" id="btnSignup">建立帳號</button>
            <button class="btn btn-line" id="btnGuest2">先用訪客模式</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ========= Supabase 設定（沿用你提供的 URL/KEY） =========
    const SUPABASE_URL = "https://rbtevdmunkjjevoeooli.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJidGV2ZG11bmtqamV2b2Vvb2xpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyNzMxMjIsImV4cCI6MjA3NTg0OTEyMn0.XjWId9AynP3TrJJEKIXZcsvmAW4kHLgH4dGDGqBH9dw";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ========= 常數：訪客導向目標 =========
    const REDIRECT_GUEST = "tool.html";

    // ========= DOM 快捷 =========
    const $  = (s, r=document)=>r.querySelector(s);
    const tabIn=$("#tab-in"), tabUp=$("#tab-up"), pIn=$("#p-in"), pUp=$("#p-up");

    // Tabs
    tabIn.addEventListener("click", e=>{e.preventDefault(); tabIn.setAttribute("aria-selected",true); tabUp.setAttribute("aria-selected",false); pIn.hidden=false; pUp.hidden=true;});
    tabUp.addEventListener("click", e=>{e.preventDefault(); tabIn.setAttribute("aria-selected",false); tabUp.setAttribute("aria-selected",true); pIn.hidden=true; pUp.hidden=false;});

    // ========= 訪客模式：建立 guestId 後「直接跳轉 tool.html」 =========
    function ensureGuestId(){
      if(!localStorage.getItem("guestId")){
        const gid = "guest_" + crypto.getRandomValues(new Uint32Array(1))[0].toString(36);
        localStorage.setItem("guestId", gid);
      }
      localStorage.setItem("authMode","guest");
    }
    function redirectGuest(){
      ensureGuestId();
      location.href = REDIRECT_GUEST; // 需求：訪客模式直接跳轉
    }

    // ========= Auth Actions（其餘照舊，不做跳轉） =========
    async function register(){
      const email = $("#email2").value.trim(), password = $("#password2").value;
      if(!email || !password) return alert("請輸入 Email 與密碼");
      const { error } = await sb.auth.signUp({ email, password });
      if(error) return alert(error.message);
      alert("註冊成功！請到信箱驗證後再登入。");
      tabIn.click();
      $("#email").value = email;
    }
    async function login(){
      const email = $("#email").value.trim(), password = $("#password").value;
      if(!email || !password) return alert("請輸入 Email 與密碼");
      const { error } = await sb.auth.signInWithPassword({ email, password });
      if(error) return alert(error.message);
      alert("登入成功（留在此頁，依你需求不跳轉）。");
    }
    async function loginWithGoogle(){
      // 照舊：不強制 redirectTo，由 Supabase 預設回來此頁（需在 Supabase 設定允許網址）
      const { error } = await sb.auth.signInWithOAuth({ provider: "google" });
      if(error) alert(error.message);
    }

    // ========= 綁定事件 =========
    $("#btnSignup").addEventListener("click", register);
    $("#btnLogin").addEventListener("click", login);
    $("#btnGoogle").addEventListener("click", loginWithGoogle);
    $("#btnGuest").addEventListener("click", redirectGuest);
    $("#btnGuest2").addEventListener("click", redirectGuest);
  </script>
</body>
</html>


